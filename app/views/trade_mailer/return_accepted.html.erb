<!DOCTYPE html>
<html>
<head>
  <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
</head>
<body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
  <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
    <h2 style="color: #10b981;">Return Accepted - Refund Processing</h2>

    <p>Hi <%= @recipient.name %>,</p>

    <p>The seller has accepted the return for Trade #<%= @trade.id %>. Your refund is being processed.</p>

    <div style="background-color: #f3f4f6; padding: 15px; border-radius: 5px; margin: 20px 0;">
      <h3 style="margin-top: 0;">Refund Details</h3>
      <p><strong>Item:</strong> <%= @trade.item&.name %></p>
      <p><strong>Original Payment:</strong> <%= number_to_currency(@trade.price / 100.0) %></p>
      <%
        refund_amount = @trade.calculate_refund_amount
        shipping_deduction = @trade.price_cents - refund_amount
      %>
      <% if shipping_deduction > 0 %>
        <p><strong>Return Shipping Deduction:</strong> -<%= number_to_currency(shipping_deduction / 100.0) %></p>
      <% end %>
      <p><strong>Refund Amount:</strong> <%= number_to_currency(refund_amount / 100.0) %></p>
    </div>

    <p>Your refund will be returned to your original payment method. Please allow 5-10 business days for the funds to appear.</p>

    <div style="margin: 30px 0;">
      <%= link_to "View Trade Details", trade_url(@trade), style: "display: inline-block; background-color: #3b82f6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px;" %>
    </div>

    <p style="color: #6b7280; font-size: 14px;">
      You will receive another email once the refund has been processed by Stripe.
    </p>
  </div>
</body>
</html>
